image: docker
services:
    - python:3.7
    - docker:dind

stages:
    - test
    - build

testing:
    stage: test
    script:
        - pip install -r requirements.txt
        - flake8 --ignore=E501,E231
        - pylint --errors-only --disable=C0301 --disable=C0326 *.py tests/*.py
        - python -m unittest discover --verbose
        - python -m pytest --junitxml=junit/test-results.xml --verbose
    artifacts:
        paths:
            - junit

building:
    stage: build
    script:
        - docker info
        - docker build -t mascot_mapper .
